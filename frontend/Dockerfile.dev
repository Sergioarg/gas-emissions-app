FROM node:20-alpine

WORKDIR /app

# Copy package files first
COPY package*.json ./
COPY angular.json ./
COPY tsconfig*.json ./

# Install dependencies
RUN npm ci

# Copy rest of the files (will be overridden by volume in dev)
COPY . .

# Copy and make entrypoint script executable
COPY docker-entrypoint.sh /docker-entrypoint.sh
RUN chmod +x /docker-entrypoint.sh

# Expose port 4200 for Angular dev server
EXPOSE 4200

# Use entrypoint script to set up proxy config and start server
ENTRYPOINT ["/docker-entrypoint.sh"]
